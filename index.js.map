{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2018/5/14/014.\n */\n\nimport findYarnWorkspaceRoot = require('find-yarn-workspace-root');\nimport yargs = require('yargs');\nimport crossSpawn = require('cross-spawn-extra');\nimport fs = require('fs-extra');\nimport path = require('path');\nimport getConfig, { parseStaticPackagesPaths } from 'workspaces-config';\nimport PackageJsonLoader from 'npm-package-json-loader';\nimport updateNotifier = require('update-notifier');\nimport pkg = require( './package.json' );\nimport { copyStaticFiles, getTargetDir } from './lib/index';\n\nupdateNotifier({ pkg }).notify();\n\nlet cli = yargs\n\t.default({\n\t\t//input: process.cwd(),\n\t})\n\t.option('npmClient', {\n\t\talias: ['N'],\n\t\trequiresArg: true,\n\t\tnormalize: true,\n\t\tdescription: 'npm, yarn, ...etc',\n\t\tdefault: 'npm',\n\t\ttype: 'string',\n\t})\n\t.option('yes', {\n\t\talias: ['y'],\n//\t\trequiresArg: true,\n//\t\tdefault: 'npm',\n\t\ttype: 'boolean',\n\t})\n\t.option('cwd', {\n\t\talias: ['C'],\n\t\trequiresArg: true,\n\t\tnormalize: true,\n//\t\tdefault: process.cwd(),\n\t\tdefaultDescription: process.cwd(),\n\t\ttype: 'string',\n\t})\n\t.option('skipCheckWorkspace', {\n\t\talias: ['W'],\n\t\ttype: 'boolean',\n\t})\n\t.option('force', {\n\t\talias: ['f'],\n\t\ttype: 'boolean',\n\t})\n\t.option('sort', {\n\t\ttype: 'boolean',\n\t\tdefault: true,\n\t})\n\t.option('private', {\n\t\talias: ['p'],\n\t\ttype: 'boolean',\n\t})\n\t.option('createModule', {\n\t\talias: ['m'],\n\t\ttype: 'string',\n\t})\n\t.option('name', {\n\t\ttype: 'string',\n\t})\n\t.option('copyStatic', {\n\t\ttype: 'boolean',\n\t})\n;\n\nlet argv = cli.argv._;\n\nlet cwd = path.resolve(cli.argv.cwd || process.cwd());\n\nlet hasWorkspace: string;\n\nif (!cli.argv.skipCheckWorkspace)\n{\n\thasWorkspace = findYarnWorkspaceRoot(cwd);\n}\n\nlet workspacePrefix: string;\n\nif (hasWorkspace)\n{\n\tlet ws = parseStaticPackagesPaths(getConfig(hasWorkspace));\n\n\tif (ws.prefix.length)\n\t{\n\t\tworkspacePrefix = ws.prefix[0];\n\t}\n}\n\nlet { targetDir, targetName } = getTargetDir({\n\tinputName: argv.length && argv[0],\n\tcwd,\n\ttargetName: cli.argv.name || null,\n\thasWorkspace,\n\tworkspacePrefix,\n});\n\n/*\n\nlet targetDir: string;\nlet targetName: string = cli.argv.name || null;\n\nif (argv.length)\n{\n\tlet name: string = argv[0];\n\n\tif (/^(?:@([^/]+?)[/])([^/]+)$/i.test(name))\n\t{\n\t\ttargetName = targetName || name;\n\t\tname = name\n\t\t\t.replace(/[\\/\\\\]+/g, '_')\n\t\t\t.replace(/^@/g, '')\n\t\t;\n\t}\n\telse if (/^[^/@]+$/i.test(name))\n\t{\n\t\ttargetName = targetName || null;\n\t}\n\telse\n\t{\n\t\ttargetName = targetName || null;\n\t}\n\n\tif (hasWorkspace)\n\t{\n\t\tlet ws = parseStaticPackagesPaths(getConfig(hasWorkspace));\n\n\t\tif (ws.prefix.length)\n\t\t{\n\t\t\tname = path.join(hasWorkspace, ws.prefix[0], name);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new RangeError();\n\t\t}\n\t}\n\n\ttargetDir = path.resolve(name);\n}\nelse\n{\n\ttargetDir = cwd;\n}\n\n*/\n\n//console.log(targetDir);\n\nfs.ensureDirSync(targetDir);\n\nlet flags = Object.keys(cli.argv)\n\t.reduce(function (a, f)\n\t{\n\t\tif (/^[a-z]$/.test(f) && cli.argv[f])\n\t\t{\n\t\t\ta.push(f);\n\t\t}\n\n\t\treturn a;\n\t}, [])\n\t.join('')\n;\n\nlet args = [\n\t'init',\n\t(flags && '-' + flags),\n\tcli.argv.createModule,\n].filter(v => v);\n\n//console.log(args);\n\nlet cp = crossSpawn.sync(cli.argv.npmClient, args, {\n\tstdio: 'inherit',\n\tcwd: targetDir,\n});\n\nif (!cp.error)\n{\n\tlet pkg = new PackageJsonLoader(path.join(targetDir, 'package.json'));\n\n\tif (pkg.exists())\n\t{\n\t\tif (cli.argv.p && cli.argv.npmClient != 'yarn')\n\t\t{\n\t\t\tpkg.data.private = true;\n\t\t}\n\n\t\tif (targetName && pkg.data.name != targetName)\n\t\t{\n\t\t\tpkg.data.name = targetName;\n\t\t}\n\n\t\tif (pkg.data.name && /^@/.test(pkg.data.name) && !pkg.data.publishConfig)\n\t\t{\n\t\t\t//pkg.data.publishConfig = {};\n\t\t}\n\n\t\tif (!pkg.data.scripts)\n\t\t{\n\t\t\tpkg.data.scripts = {};\n\t\t}\n\n\t\tObject\n\t\t\t.entries({\n\t\t\t\t\"ncu\": \"npx npm-check-updates -u\",\n\t\t\t\t\"sort-package-json\": \"npx sort-package-json ./package.json\",\n\t\t\t\t\"prepublishOnly\": \"npm run ncu && npm run sort-package-json && npm run test\",\n\t\t\t\t\"coverage\": \"npx nyc npm run test\",\n\t\t\t\t\"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n\t\t\t})\n\t\t\t.forEach(([k, v]) =>\n\t\t\t{\n\t\t\t\tif (pkg.data.scripts[k] == null)\n\t\t\t\t{\n\t\t\t\t\tpkg.data.scripts[k] = v;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tpkg.autofix();\n\n\t\tif (cli.argv.sort)\n\t\t{\n\t\t\tpkg.sort();\n\t\t}\n\n\t\tpkg.writeWhenLoaded();\n\n\t\tlet copyOptions: fs.CopyOptionsSync = {\n\t\t\toverwrite: false,\n\t\t\tpreserveTimestamps: true,\n\t\t\terrorOnExist: false,\n\t\t};\n\n\t\ttry\n\t\t{\n\t\t\tfs.copySync(path.join(__dirname, 'lib/static'), targetDir, copyOptions);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\n\t\t}\n\n\t\tcopyStaticFiles([\n\n\t\t\t['.npmignore', 'file/npmignore'],\n\t\t\t['.gitignore', 'file/gitignore'],\n\n\t\t\t['.nvmrc', 'file/nvmrc'],\n\t\t\t['.browserslistrc', 'file/browserslistrc'],\n\n\t\t\t['tsconfig.json.tpl', 'file/tsconfig.json.tpl', 'tsconfig.json'],\n\n\t\t\t['.eslintrc.json.tpl', 'file/eslintrc.json.tpl', '.eslintrc.json'],\n\n\t\t], {\n\t\t\tcwd: targetDir,\n\t\t});\n\n\t\t/*\n\t\tfs.copySync(path.join(__dirname, 'lib/file/npmignore'), path.join(targetDir, '.npmignore'), copyOptions);\n\n\t\tfs.copySync(path.join(__dirname, 'lib/file/gitignore'), path.join(targetDir, '.gitignore'), copyOptions);\n\n\t\tif (!fs.pathExistsSync(path.join(targetDir, 'tsconfig.json')))\n\t\t{\n\t\t\tfs.copySync(path.join(__dirname, 'lib/file/tsconfig.json.tpl'), path.join(targetDir, 'tsconfig.json.tpl'), copyOptions);\n\t\t}\n\t\t */\n\n\t}\n}\n"]}