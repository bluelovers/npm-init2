{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":";AAAA;;GAEG;;AAEH,kEAAmE;AACnE,+BAAiC;AACjC,gDAAiD;AACjD,+BAAgC;AAChC,6BAA+B;AAC/B,yDAAwE;AACxE,qEAAwD;AACxD,kDAAmD;AACnD,sCAAyC;AAEzC,cAAc,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC;AAEjC,IAAI,GAAG,GAAG,KAAK;KACb,OAAO,CAAC;AACR,uBAAuB;CACvB,CAAC;KACD,MAAM,CAAC,WAAW,EAAE;IACpB,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,WAAW,EAAE,IAAI;IACjB,SAAS,EAAE,IAAI;IACf,WAAW,EAAE,mBAAmB;IAChC,OAAO,EAAE,KAAK;IACd,IAAI,EAAE,QAAQ;CACd,CAAC;KACD,MAAM,CAAC,KAAK,EAAE;IACd,KAAK,EAAE,CAAC,GAAG,CAAC;IACd,sBAAsB;IACtB,mBAAmB;IACjB,IAAI,EAAE,SAAS;CACf,CAAC;KACD,MAAM,CAAC,KAAK,EAAE;IACd,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,WAAW,EAAE,IAAI;IACjB,SAAS,EAAE,IAAI;IACjB,2BAA2B;IACzB,kBAAkB,EAAE,OAAO,CAAC,GAAG,EAAE;IACjC,IAAI,EAAE,QAAQ;CACd,CAAC;KACD,MAAM,CAAC,oBAAoB,EAAE;IAC7B,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,IAAI,EAAE,SAAS;CACf,CAAC;KACD,MAAM,CAAC,OAAO,EAAE;IAChB,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,IAAI,EAAE,SAAS;CACf,CAAC;KACD,MAAM,CAAC,MAAM,EAAE;IACf,IAAI,EAAE,SAAS;IACf,OAAO,EAAE,IAAI;CACb,CAAC;KACD,MAAM,CAAC,SAAS,EAAE;IAClB,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,IAAI,EAAE,SAAS;CACf,CAAC;KACD,MAAM,CAAC,cAAc,EAAE;IACvB,KAAK,EAAE,CAAC,GAAG,CAAC;IACZ,IAAI,EAAE,QAAQ;CACd,CAAC;KACD,MAAM,CAAC,MAAM,EAAE;IACf,IAAI,EAAE,QAAQ;CACd,CAAC;KACD,MAAM,CAAC,YAAY,EAAE;IACrB,IAAI,EAAE,SAAS;CACf,CAAC,CACF;AAED,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;AAEtB,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;AAEtD,IAAI,YAAoB,CAAC;AAEzB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,EAChC;IACC,YAAY,GAAG,qBAAqB,CAAC,GAAG,CAAC,CAAC;CAC1C;AAED,IAAI,SAAiB,CAAC;AACtB,IAAI,UAAU,GAAW,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC;AAE/C,IAAI,IAAI,CAAC,MAAM,EACf;IACC,IAAI,IAAI,GAAW,IAAI,CAAC,CAAC,CAAC,CAAC;IAE3B,IAAI,4BAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,EAC3C;QACC,UAAU,GAAG,UAAU,IAAI,IAAI,CAAC;QAChC,IAAI,GAAG,IAAI;aACT,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC;aACxB,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CACnB;KACD;SACI,IAAI,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAC/B;QACC,UAAU,GAAG,UAAU,IAAI,IAAI,CAAC;KAChC;SAED;QACC,UAAU,GAAG,UAAU,IAAI,IAAI,CAAC;KAChC;IAED,IAAI,YAAY,EAChB;QACC,IAAI,EAAE,GAAG,4CAAwB,CAAC,2BAAS,CAAC,YAAY,CAAC,CAAC,CAAC;QAE3D,IAAI,EAAE,CAAC,MAAM,CAAC,MAAM,EACpB;YACC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;SACnD;aAED;YACC,MAAM,IAAI,UAAU,EAAE,CAAC;SACvB;KACD;IAED,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;CAC/B;KAED;IACC,SAAS,GAAG,GAAG,CAAC;CAChB;AAED,yBAAyB;AAEzB,EAAE,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;AAE5B,IAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;KAC/B,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC;IAErB,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EACpC;QACC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACV;IAED,OAAO,CAAC,CAAC;AACV,CAAC,EAAE,EAAE,CAAC;KACL,IAAI,CAAC,EAAE,CAAC,CACT;AAED,IAAI,IAAI,GAAG;IACV,MAAM;IACN,CAAC,KAAK,IAAI,GAAG,GAAG,KAAK,CAAC;IACtB,GAAG,CAAC,IAAI,CAAC,YAAY;CACrB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAEjB,oBAAoB;AAEpB,IAAI,EAAE,GAAG,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE;IAClD,KAAK,EAAE,SAAS;IAChB,GAAG,EAAE,SAAS;CACd,CAAC,CAAC;AAEH,IAAI,CAAC,EAAE,CAAC,KAAK,EACb;IACC,IAAI,GAAG,GAAG,IAAI,iCAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC,CAAC;IAEtE,IAAI,GAAG,CAAC,MAAM,EAAE,EAChB;QACC,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,SAAS,IAAI,MAAM,EAC9C;YACC,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACxB;QAED,IAAI,UAAU,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,UAAU,EAC7C;YACC,GAAG,CAAC,IAAI,CAAC,IAAI,GAAG,UAAU,CAAC;SAC3B;QAED,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EACxE;YACC,8BAA8B;SAC9B;QAED,GAAG,CAAC,OAAO,EAAE,CAAC;QAEd,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,EACjB;YACC,GAAG,CAAC,IAAI,EAAE,CAAC;SACX;QAED,GAAG,CAAC,eAAe,EAAE,CAAC;QAEtB,IAAI,WAAW,GAAG;YACjB,SAAS,EAAE,KAAK;YAChB,kBAAkB,EAAE,IAAI;YACxB,YAAY,EAAE,KAAK;SACnB,CAAC;QAEF,IACA;YACC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,EAAE,SAAS,EAAE,WAAW,CAAC,CAAC;SACxE;QACD,OAAO,CAAC,EACR;SAEC;QAED,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,oBAAoB,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,EAAE,WAAW,CAAC,CAAC;QAEzG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,oBAAoB,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,EAAE,WAAW,CAAC,CAAC;QAEzG,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC,EAC7D;YACC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,4BAA4B,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,mBAAmB,CAAC,EAAE,WAAW,CAAC,CAAC;SACxH;KAED;CACD","sourcesContent":["/**\n * Created by user on 2018/5/14/014.\n */\n\nimport findYarnWorkspaceRoot = require('find-yarn-workspace-root');\nimport yargs  = require('yargs');\nimport crossSpawn = require('cross-spawn-extra');\nimport fs = require('fs-extra');\nimport path  = require('path');\nimport getConfig, { parseStaticPackagesPaths } from 'workspaces-config';\nimport PackageJsonLoader from 'npm-package-json-loader';\nimport updateNotifier = require('update-notifier');\nimport pkg = require( './package.json' );\n\nupdateNotifier({ pkg }).notify();\n\nlet cli = yargs\n\t.default({\n\t\t//input: process.cwd(),\n\t})\n\t.option('npmClient', {\n\t\talias: ['N'],\n\t\trequiresArg: true,\n\t\tnormalize: true,\n\t\tdescription: 'npm, yarn, ...etc',\n\t\tdefault: 'npm',\n\t\ttype: 'string',\n\t})\n\t.option('yes', {\n\t\talias: ['y'],\n//\t\trequiresArg: true,\n//\t\tdefault: 'npm',\n\t\ttype: 'boolean',\n\t})\n\t.option('cwd', {\n\t\talias: ['C'],\n\t\trequiresArg: true,\n\t\tnormalize: true,\n//\t\tdefault: process.cwd(),\n\t\tdefaultDescription: process.cwd(),\n\t\ttype: 'string',\n\t})\n\t.option('skipCheckWorkspace', {\n\t\talias: ['W'],\n\t\ttype: 'boolean',\n\t})\n\t.option('force', {\n\t\talias: ['f'],\n\t\ttype: 'boolean',\n\t})\n\t.option('sort', {\n\t\ttype: 'boolean',\n\t\tdefault: true,\n\t})\n\t.option('private', {\n\t\talias: ['p'],\n\t\ttype: 'boolean',\n\t})\n\t.option('createModule', {\n\t\talias: ['m'],\n\t\ttype: 'string',\n\t})\n\t.option('name', {\n\t\ttype: 'string',\n\t})\n\t.option('copyStatic', {\n\t\ttype: 'boolean',\n\t})\n;\n\nlet argv = cli.argv._;\n\nlet cwd = path.resolve(cli.argv.cwd || process.cwd());\n\nlet hasWorkspace: string;\n\nif (!cli.argv.skipCheckWorkspace)\n{\n\thasWorkspace = findYarnWorkspaceRoot(cwd);\n}\n\nlet targetDir: string;\nlet targetName: string = cli.argv.name || null;\n\nif (argv.length)\n{\n\tlet name: string = argv[0];\n\n\tif (/^(?:@([^/]+?)[/])([^/]+)$/i.test(name))\n\t{\n\t\ttargetName = targetName || name;\n\t\tname = name\n\t\t\t.replace(/[\\/\\\\]+/g, '_')\n\t\t\t.replace(/^@/g, '')\n\t\t;\n\t}\n\telse if (/^[^/@]+$/i.test(name))\n\t{\n\t\ttargetName = targetName || null;\n\t}\n\telse\n\t{\n\t\ttargetName = targetName || null;\n\t}\n\n\tif (hasWorkspace)\n\t{\n\t\tlet ws = parseStaticPackagesPaths(getConfig(hasWorkspace));\n\n\t\tif (ws.prefix.length)\n\t\t{\n\t\t\tname = path.join(hasWorkspace, ws.prefix[0], name);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new RangeError();\n\t\t}\n\t}\n\n\ttargetDir = path.resolve(name);\n}\nelse\n{\n\ttargetDir = cwd;\n}\n\n//console.log(targetDir);\n\nfs.ensureDirSync(targetDir);\n\nlet flags = Object.keys(cli.argv)\n\t.reduce(function (a, f)\n\t{\n\t\tif (/^[a-z]$/.test(f) && cli.argv[f])\n\t\t{\n\t\t\ta.push(f);\n\t\t}\n\n\t\treturn a;\n\t}, [])\n\t.join('')\n;\n\nlet args = [\n\t'init',\n\t(flags && '-' + flags),\n\tcli.argv.createModule,\n].filter(v => v);\n\n//console.log(args);\n\nlet cp = crossSpawn.sync(cli.argv.npmClient, args, {\n\tstdio: 'inherit',\n\tcwd: targetDir,\n});\n\nif (!cp.error)\n{\n\tlet pkg = new PackageJsonLoader(path.join(targetDir, 'package.json'));\n\n\tif (pkg.exists())\n\t{\n\t\tif (cli.argv.p && cli.argv.npmClient != 'yarn')\n\t\t{\n\t\t\tpkg.data.private = true;\n\t\t}\n\n\t\tif (targetName && pkg.data.name != targetName)\n\t\t{\n\t\t\tpkg.data.name = targetName;\n\t\t}\n\n\t\tif (pkg.data.name && /^@/.test(pkg.data.name) && !pkg.data.publishConfig)\n\t\t{\n\t\t\t//pkg.data.publishConfig = {};\n\t\t}\n\n\t\tpkg.autofix();\n\n\t\tif (cli.argv.sort)\n\t\t{\n\t\t\tpkg.sort();\n\t\t}\n\n\t\tpkg.writeWhenLoaded();\n\n\t\tlet copyOptions = {\n\t\t\toverwrite: false,\n\t\t\tpreserveTimestamps: true,\n\t\t\terrorOnExist: false,\n\t\t};\n\n\t\ttry\n\t\t{\n\t\t\tfs.copySync(path.join(__dirname, 'lib/static'), targetDir, copyOptions);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\n\t\t}\n\n\t\tfs.copySync(path.join(__dirname, 'lib/file/npmignore'), path.join(targetDir, '.npmignore'), copyOptions);\n\n\t\tfs.copySync(path.join(__dirname, 'lib/file/gitignore'), path.join(targetDir, '.gitignore'), copyOptions);\n\n\t\tif (!fs.pathExistsSync(path.join(targetDir, 'tsconfig.json')))\n\t\t{\n\t\t\tfs.copySync(path.join(__dirname, 'lib/file/tsconfig.json.tpl'), path.join(targetDir, 'tsconfig.json.tpl'), copyOptions);\n\t\t}\n\n\t}\n}\n"]}